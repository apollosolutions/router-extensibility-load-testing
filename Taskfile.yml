version: 3

dotenv:
  - .env

vars:
  COPROCESSOR_PORT: 8000
  DURATION: 30s
  RATE: 100

includes:
  static:
    taskfile: ./Taskfile.Test.yml
    vars:
      TEST_NAME: static-subgraph
  guid:
    taskfile: ./Taskfile.Test.yml
    vars:
      TEST_NAME: guid-response
  ca:
    taskfile: ./Taskfile.Test.yml
    vars:
      TEST_NAME: jwt-client-awareness
  local:
    taskfile: ./Taskfile.Test.yml
    vars:
      TEST_NAME: local-subgraphs
  shared:
    taskfile: ./Taskfile.Shared.yml

tasks:
  generate-report:
    dir: results-generator/
    cmds:
      - npm i
      - node index.js > results.md
  static:
    cmds:
      - task: static:baseline
      - task: static:go
      - task: static:node
      - task: static:rhai
      - task: static:config
  guid:
    cmds:
      - task: guid:baseline
      - task: guid:go
      - task: guid:node
      - task: guid:rhai
  awareness:
    cmds:
      - task: ca:baseline
      - task: ca:go
      - task: ca:node
  test-local:
    aliases:
      - local
    cmds:
      - task: local:baseline
      - task: local:local-subgraphs
      - task: generate-report
  test-all:
    aliases:
      - all
      - test
    cmds:
      - task: static
      - task: guid
      - task: awareness
      - task: generate-report
